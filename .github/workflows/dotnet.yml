# This workflow builds and tests the .NET solution (excluding DB project)
name: .NET

permissions:
  contents: read

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install pinned .NET SDK 8.0.100
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 8.0.100
      - name: Display SDK version
        run: dotnet --info
      - name: Restore (solution)
        run: dotnet restore ITCompanion.sln
      - name: Build (selected projects)
        run: >-
          dotnet build src/ClientShared/ClientShared.csproj -c Debug --no-restore
          && dotnet build src/CorePolicyEngine/CorePolicyEngine.csproj -c Debug --no-restore
          && dotnet build src/ITCompanionClient/ITCompanionClient.csproj -c Debug --no-restore
          && dotnet build src/Security/Security.csproj -c Debug --no-restore
      - name: Test
        run: dotnet test ITCompanion.sln --no-build --configuration Debug --verbosity normal --filter FullyQualifiedName~Tests
